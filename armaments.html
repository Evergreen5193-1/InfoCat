<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armaments Calculator - InfoCat</title>
    <link rel="icon" type="image/png" href="infocat-smaller.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111118; /* A slightly deeper black */
        }
        .brand-purple { color: #9D8DF1; }
        .bg-brand-purple { background-color: #9D8DF1; }
        .border-brand-purple { border-color: #9D8DF1; }
        .bg-brand-gradient {
            background-image: linear-gradient(to right, #9D8DF1, #B8CDF8);
        }
        .glassmorphism {
            background: rgba(30, 30, 40, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(157, 141, 241, 0.15);
        }
        .page-bg {
            background-color: #111118;
            background-image: 
                radial-gradient(ellipse 80% 50% at 15% 50%, rgba(157, 141, 241, 0.1), transparent),
                radial-gradient(ellipse 80% 50% at 90% 40%, rgba(80, 100, 220, 0.1), transparent);
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a22;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a5a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9D8DF1;
        }
        /* Styling for form elements to match the theme */
        select, input[type="number"], input[type="text"] {
            background-color: rgba(17, 17, 24, 0.8);
            border: 1px solid rgba(157, 141, 241, 0.2);
            color: #E5E7EB; /* gray-200 */
        }
        select:focus, input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #9D8DF1;
            box-shadow: 0 0 0 2px rgba(157, 141, 241, 0.4);
        }
    </style>
</head>
<body class="text-gray-200 page-bg">

    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 glassmorphism">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="index.html" class="flex items-center space-x-3">
                    <img src="https://raw.githubusercontent.com/user-attachments/assets/4312fb14-52a1-424a-afe1-a472491a3298/Infocat.png" alt="InfoCat Logo" class="h-12 w-12 rounded-lg"
                         onerror="this.onerror=null;this.src='https://placehold.co/50x50/9D8DF1/ffffff?text=iC';">
                    <span class="hidden sm:block text-2xl font-bold text-white">InfoCat</span>
                </a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="index.html#trackers" class="hover:text-brand-purple transition-colors duration-300">Trackers</a>
                    <a href="#" class="text-brand-purple font-semibold transition-colors duration-300">Calculators</a>
                    <a href="about.html" class="hover:text-brand-purple transition-colors duration-300">About</a>
                </nav>

                <div class="hidden md:block">
                    <a href="login.html" class="group relative inline-block text-sm font-medium text-white focus:outline-none focus:ring">
                        <span class="absolute inset-0 border border-brand-purple rounded-lg"></span>
                        <span class="block border border-gray-800 rounded-lg bg-gray-900 px-6 py-3 transition-transform active:bg-brand-purple/20 group-hover:-translate-x-1 group-hover:-translate-y-1">
                            Connect with Discord
                        </span>
                    </a>
                </div>

                <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden pb-4">
            <a href="index.html#trackers" class="block py-2 px-4 text-sm hover:bg-gray-700">Trackers</a>
            <a href="#" class="block py-2 px-4 text-sm bg-gray-700 text-brand-purple font-semibold">Calculators</a>
            <a href="about.html" class="block py-2 px-4 text-sm hover:bg-gray-700">About</a>
             <div class="px-4 mt-4">
                 <a href="login.html" class="block w-full text-center bg-brand-purple text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition-all duration-300">
                     Connect with Discord
                 </a>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white">
                    Armaments 
                    <span class="block bg-clip-text text-transparent bg-brand-gradient mt-2">Calculator</span>
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-400">
                    Calculate the optimal score for your armament setup with our comprehensive inscription system tool.
                    <br>
                    <span class="text-sm text-gray-500">Calculator logic created by Davor.</span>
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 flex flex-col gap-8">
                    <div class="p-6 glassmorphism rounded-xl">
                        <h3 class="text-2xl font-bold text-white mb-6">‚öôÔ∏è Configuration</h3>
                        <div class="space-y-4">
                            <div class="form-group">
                                <label for="pairing" class="block text-sm font-medium text-gray-300 mb-2">Commander Pairing</label>
                                <select id="pairing" class="w-full p-3 rounded-lg text-sm"></select>
                            </div>
                            <div class="form-group">
                                <label for="formation" class="block text-sm font-medium text-gray-300 mb-2">Formation</label>
                                <select id="formation" class="w-full p-3 rounded-lg text-sm"></select>
                            </div>
                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Base Attributes</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="attack" class="block text-xs text-gray-400">Attack</label>
                                        <input type="number" id="attack" value="13" min="0" step="0.1" class="w-full p-2 rounded-md mt-1 text-sm">
                                    </div>
                                    <div>
                                        <label for="defense" class="block text-xs text-gray-400">Defense</label>
                                        <input type="number" id="defense" value="4" min="0" step="0.1" class="w-full p-2 rounded-md mt-1 text-sm">
                                    </div>
                                    <div>
                                        <label for="health" class="block text-xs text-gray-400">Health</label>
                                        <input type="number" id="health" value="9" min="0" step="0.1" class="w-full p-2 rounded-md mt-1 text-sm">
                                    </div>
                                    <div>
                                        <label for="allDamage" class="block text-xs text-gray-400">All Damage</label>
                                        <input type="number" id="allDamage" value="2" min="0" step="0.1" class="w-full p-2 rounded-md mt-1 text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 glassmorphism rounded-xl text-center">
                         <h3 class="text-2xl font-bold text-white mb-4">üèÜ Results</h3>
                         <div id="totalScore" class="text-6xl font-black brand-purple tracking-tight">0.00</div>
                         <p class="text-gray-400 mb-6">Total Armament Score</p>
                        
                         <div id="scoreBreakdown" class="grid grid-cols-3 gap-2 text-xs text-left mb-6">
                             </div>

                         <div class="form-group">
                              <label for="description" class="sr-only">Description</label>
                              <input type="text" id="description" placeholder="Enter description for this setup..." class="w-full p-3 rounded-lg text-sm text-center">
                         </div>
                        
                         <div class="flex flex-col gap-3 mt-4">
                             <button onclick="saveToHistory()" class="w-full bg-brand-purple text-white font-bold py-3 px-4 rounded-lg hover:bg-opacity-90 transition-all duration-300">Save Setup</button>
                             <div class="grid grid-cols-2 gap-3">
                                 <button onclick="copyDiscordEmbed()" class="w-full bg-gray-700/50 text-gray-200 font-bold py-3 px-4 rounded-lg hover:bg-gray-600/50 transition-all duration-300">Copy Discord</button>
                                 <button onclick="clearAll()" class="w-full bg-red-900/50 text-red-300 font-bold py-3 px-4 rounded-lg hover:bg-red-800/50 transition-all duration-300">Clear All</button>
                             </div>
                         </div>
                     </div>
                </div>

                <div class="p-6 glassmorphism rounded-xl lg:col-span-2">
                    <h3 class="text-2xl font-bold text-white mb-6">üìú Inscriptions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="inscription-category">
                            <h4 class="text-lg font-semibold mb-3 border-b border-gray-700 pb-2 text-purple-400">Formation Bonus</h4>
                            <div id="formationBonus" class="text-sm text-gray-300 font-medium"></div>
                        </div>
                        <div></div> <div class="inscription-category">
                            <h4 class="text-lg font-semibold mb-3 border-b border-gray-700 pb-2 text-orange-400">Special (Legendary) <span class="text-sm font-normal text-gray-400">(Max 4)</span></h4>
                            <div id="specialInscriptions" class="space-y-3"></div>
                        </div>
                        <div class="inscription-category">
                            <h4 class="text-lg font-semibold mb-3 border-b border-gray-700 pb-2 text-blue-400">Rare (Blue) <span class="text-sm font-normal text-gray-400">(Max 4)</span></h4>
                            <div id="rareInscriptions" class="space-y-3"></div>
                        </div>
                        <div class="inscription-category md:col-span-2">
                             <h4 class="text-lg font-semibold mb-3 border-b border-gray-700 pb-2 text-green-400">Common (Green/White)</h4>
                            <div id="commonInscriptions" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-3"></div>
                        </div>
                    </div>
                </div>

                <div class="p-6 glassmorphism rounded-xl lg:col-span-3">
                    <h3 class="text-2xl font-bold text-white mb-6">üìö Calculation History</h3>
                    <div id="historyContainer" class="space-y-3 max-h-64 overflow-y-auto pr-2">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900/50 border-t border-gray-800 mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="flex flex-col md:flex-row justify-center items-center text-center">
                 <div class="mb-6 md:mb-0">
                     <a href="index.html" class="flex items-center justify-center md:justify-start space-x-3">
                         <img src="https://raw.githubusercontent.com/user-attachments/assets/4312fb14-52a1-424a-afe1-a472491a3298/Infocat.png" alt="InfoCat Logo" class="h-10 w-10 rounded-lg"
                         onerror="this.onerror=null;this.src='https://placehold.co/40x40/9D8DF1/ffffff?text=iC';">
                         <span class="text-xl font-bold text-white">InfoCat</span>
                     </a>
                     <p class="text-gray-400 text-sm mt-2">
                         &copy; 2025 InfoCat. Not affiliated with Lilith Games.
                     </p>
                 </div>
            </div>
        </div>
    </footer>

    <script>
        // --- CORE CALCULATOR LOGIC (from original file, unmodified) ---
        const pairingScales = { "HUO / ARTHUR": [1, 1.36, 1.51, 3.09, 0.62, 0.31, 2.47, 0, 0], "HUO / JOAN": [1, 1.32, 1.53, 3, 0.6, 0.3, 2.4, 0, 0], "HUO / BELISARIUS": [1, 1.24, 1.64, 2.8, 0.56, 0.28, 2.24, 0, 0], "NEVSKY / JOAN": [1, 1.34, 1.3, 2.62, 0.66, 0.33, 1.96, 0, 0], "JOAN / BELISARIUS": [1, 1.36, 1.53, 2.7, 0.8, 0.4, 1.9, 0, 0], "ARTHUR / WILLIAM": [1, 1.53, 1.51, 2.83, 0.8, 0.4, 0.6, 0, 1.12], "ARTHUR / PHILIP": [1, 1.56, 1.65, 2.31, 0.85, 0.42, 0.31, 0, 1.15], "BAI QI / LIU CHE": [1, 1.23, 1.76, 2.96, 2.96, 0.37, 0, 2.22, 0.1], "BAI QI / WALLACE": [1, 1.18, 1.74, 2.87, 2.87, 0.41, 0, 2.15, 0], "BAI QI / CJ": [1, 1.36, 1.85, 3, 3, 0.47, 0, 2.06, 0], "LIU CHE / ALEX": [1, 1.1, 1.83, 2.85, 1.47, 0.3, 0.8, 1.07, 0.1], "LIU CHE / PHILIP": [1, 0.97, 1.66, 2.08, 1.32, 0.3, 0.32, 0.92, 0.1], "RAGNAR / SCIPIO": [1, 1.11, 1.62, 2.87, 0.72, 0.36, 2.15, 0, 0], "ZHUGE / HERMANN": [1, 1.25, 1.41, 2.77, 0.73, 0.36, 2.04, 0, 0], "ZHUGE / PHILIP": [1, 1.25, 1.14, 2.04, 0.76, 0.38, 1.29, 0, 0], "ASHUR / YSG": [1, 1.19, 1.71, 2.96, 0.71, 0.36, 2.25, 0, 0], "ASHUR / HERMANN": [1, 1.19, 1.72, 2.94, 0.71, 0.36, 2.25, 0, 0], "SHAJAR / YSG": [1, 1.21, 1.37, 2.79, 0.56, 0.28, 2.23, 0, 0] };
        const formationBonuses = { "ARCH": [0, 0, 0, 0, 5, 0, 0, 0, 0], "WEDGE": [0, 0, 0, 0, 0, 0, 5, 0, 0], "HOLLOW SQUARE": [0, 0, 0, 2, 0, 0, 0, 0, 0], "DELTA": [0, 0, 0, 0, 0, 0, 0, 0, 10], "PINCER": [0, 0, 0, 0, 0, 0, 0, 10, 0] };
        const specialInscriptions = { "Destructive": [0, 0, 0, 0, 3.5, 0, -3.5, -7, -3.5], "Straight to the Point": [0, 0, 0, 0, 5.78, 0, -2.1, 0, 0], "Invincible": [0, 0, 0, 0, 4.5, 0, 5, 0, 0], "Fearless": [0, 0, 0, 0, 8, 0, 0, 0, 0], "Hunter": [0, 0, 0, 0, 0, 0, 7, 0, 0], "Unstoppable": [0, 0, 0, 0, 0, 0, 6, 0, 0], "Balanced": [0, 0, 0, 0, 3.5, 0, 4, 0, 0], "Intrepid": [0, 0, 0, 0, 0, 0, 10, 0, 0], "Cocoon": [0, 0, 0, 0, 0, 0, 5, 0, 0], "Inviolable": [0, 0, 0, 3.75, 0, 0, 0, 0, 0], "Crowned": [0, 0, 0, 2.5, 0, 0, 0, 0, 0], "Rounded": [0, 0, 0, 5, 0, 0, 0, 0, 0], "Trasher": [0, 0, 0, 0, 0, 0, 0, 0, 7.5], "Butterfly": [0, 0, 0, 0, 0, 0, 0, 0, 3.5], "Steelskin": [0, 0, 0, 5, 0, 0, 0, 0, 0], "Flurry": [0, 0, 0, 0, 0, 0, 0, 0, 8], "Toppler": [0, 0, 0, 0, 0, 0, 0, 10, 0], "Demolisher": [0, 3.75, 0, 0, 0, 0, 0, 5, 0], "Airtight": [0, 0, 0, 3.75, 0, 0, 0, 0, 0], "Thundering": [0, 0, 0, 0, 0, 0, 0, 10, 0] };
        const rareInscriptions = { "Battle Ready": [0, 0, 0, 0, 5, 0, -3.5, -6, -3.5], "Even Keeled": [0, 0, 0, 1.07, 1.5, 0, 2.1, 0, 0], "Unswerving": [0, 0, 0, 0, 0, 0, 4, 0, 0], "Forceful": [0, 0, 0, 0, 3, 0, 0, 0, 0], "Crazed": [0, 0, 0, 0.5, 0, 0, 0, 0, 0], "Boiling Blood": [0, 0, 0, 0, 0, 0, 3.15, 0, 0], "Defiant": [0, 0, 0, 0, 3, 0, 0, 0, 0], "Focus Fire": [0, 0, 0, 0, 0, 0, 4, 0, 0], "Self Defense": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Aegis": [0, 0, 0, 1.875, 0, 0, 0, 0, 0], "Reinforced": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Tenacious": [0, 0, 0, 2, 0, 0, 0, 0, 0], "Pummeler": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Causative": [0, 0, 0, 0, 0, 0, 0, 0, 1.5], "Determined": [0, 0, 0, 1.5, 0, 0, 0, 0, 0], "Relentless": [0, 0, 0, 0, 0, 0, 0, 0, 3.5], "Imploder": [0, 5, 0, 0, 0, 0, 0, 0, 0], "Raider": [0, 0, 0, 0, 0, 0, 0, 2, 0], "Hardheaded": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Rattling": [0, 0, 0, 0, 0, 0, 0, 4, 0] };
        const commonInscriptions = { "Warcry/Brutal/Spiked/Infamy": [3.5, 0, 0, 0, 0, 0, 0, 0, 0], "Well Clad/Armored/Metallics/Shielded": [0, 3.5, 0, 0, 0, 0, 0, 0, 0], "Robust/Fit/Vitality/Hardy": [0, 0, 3.5, 0, 0, 0, 0, 0, 0], "Onslaught/Warhunger/Striker/Militant": [0, 0, 0, 0, 1.5, 0, 0, 0, 0], "Retaliatory/Alert/Rebuff/Resistant": [0, 0, 0, 0, 0, 2.5, 0, 0, 0], "Enraged/Devious/Brawler/Daring": [0, 0, 0, 0, 0, 1, 2.5, 0, 0], "Valiant/Fearsome/Warflames/Elite": [0, 0, 0, 1, 0, 0, 0, 0, 0], "Evasive (on instrument)": [0, 0, 0, 0, 0, 2.5, 0, 0, 0], "Evasive (on Emblem)": [0, 0, 0, 1, 0, 0, 0, 0, 0], "Iron Wall": [0, 0, 0, 0, 1.5, 0, 0, 0, 0], "Bellicose": [0, 0, 0, 1.07, 0, 0, 0, 0, 0], "Pulverize": [0, 0, 0, 0, 1.42, 0, 0, 0, 0], "Breaker": [0, 3.2, 0, 0, 0, 0, 0, 0, 0], "Furious": [0, 0, 0, 0, 1.5, 0, 4, 0, 0], "Ward": [0, 0, 0, 1.87, 0, 0, 0, 0, 0], "Calm": [2.3, 0, 0, 0, 0, 0, 0, 0, 0], "Requital": [0, 0, 0, 0, 1.78, 0, 0, 0, 0], "Respite": [0, 0, 0, 1.42, 0, 0, 0, 0, 0], "Guarded": [0, 0, 0, 0, 0, 0, 1.42, 0, 0], "Embattled": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Vengeful": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Uplifting": [0, 0, 0, 0, 1, 0, 0, 0, 0], "Spirited": [0, 0, 0, 0, 1, 0, 0, 0, 0], "Eclipsed": [0, 0, 0, 0, 0, 0, 2.5, 0, 0], "Brave": [0, 0, 0, 0, 0, 5, 0, 0, 0], "Strategic": [0, 0, 0, 2, 0, 0, 0, 0, 0], "Desperado": [0, 0, 0, 2, 0, 0, 0, 0, 0], "Cohesive": [0, 0, 0, 0.5, 0, 0, 0, 0, 0], "Pursuer": [0, 0, 0, 2, 0, 0, 0, 0, 0], "Assertive": [0, 0, 0, 2, 0, 0, 0, 0, 0], "Siegework": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Sentries": [0, 0, 0, 0, 0, 0, 0, 0, 0], "Ballistics": [0, 0, 0, 0, 0, 1.5, 0, 0, 0], "Smite": [0, 0, 0, 0, 2, 0, 0, 0, 0], "Enduring": [0, 0, 0, 0, 0, 3, 0, 0, 0], "Artisan": [0, 0, 0, 0, 0, 1, 3, 0, 0], "Rapacious": [0, 0, 0, 1.5, 0, 0, 0, 0, 0], "Guardians": [0, 0, 0, 0, 0, 2, 0, 0, 0], "Counterer": [0, 0, 0, 0, 0, 3, 0, 0, 0], "Deflector": [0, 0, 0, 0, 0, 0, 3, 0, 0], "Lineshot": [0, 0, 0, 0, 1, 0, 0, 0, 0], "Watchmen": [0, 0, 0, 1.5, 0, 0, 0, 0, 0] };
        
        let calculationHistory = JSON.parse(localStorage.getItem('armamentsHistory_v2') || '[]');

        function initializeApp() {
            // Populate dropdowns
            const pairingSelect = document.getElementById('pairing');
            Object.keys(pairingScales).forEach(p => pairingSelect.add(new Option(p, p)));
            
            const formationSelect = document.getElementById('formation');
            Object.keys(formationBonuses).forEach(f => formationSelect.add(new Option(f, f)));

            // Populate Inscriptions
            populateInscriptions('special', specialInscriptions, 4);
            populateInscriptions('rare', rareInscriptions, 4);
            populateInscriptions('common', commonInscriptions, 8); // Arbitrary high number for common

            // Add event listeners
            document.querySelectorAll('select, input[type="number"]').forEach(el => {
                el.addEventListener('change', () => {
                    if (el.id === 'formation') updateFormationBonus();
                    calculateScore();
                });
            });
             document.querySelectorAll('input[type="number"]').forEach(el => {
                el.addEventListener('keyup', calculateScore);
            });


            updateFormationBonus();
            calculateScore();
            updateHistoryDisplay();
        }

        function populateInscriptions(category, data, count) {
            const container = document.getElementById(`${category}Inscriptions`);
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                createSearchableDropdown(category, data, container, i);
            }
        }

        function createSearchableDropdown(category, data, container, index) {
            const dropdownId = `${category}_${index}`;
            const select = document.createElement('select');
            select.id = dropdownId;
            select.dataset.category = category;
            select.className = 'w-full p-3 rounded-lg text-sm';

            select.add(new Option(`-- Select ${category.charAt(0).toUpperCase() + category.slice(1)} --`, ''));
            Object.keys(data).forEach(name => {
                const displayName = name.split('/')[0];
                select.add(new Option(displayName, name));
            });

            select.addEventListener('change', calculateScore);
            container.appendChild(select);
        }

        function updateFormationBonus() {
            const formation = document.getElementById('formation').value;
            const bonusDisplay = document.getElementById('formationBonus');
            const bonus = formationBonuses[formation];
            let bonusText = '';
            if (bonus[4] > 0) bonusText += `Normal Attack +${bonus[4]}% `;
            if (bonus[6] > 0) bonusText += `Skill DMG +${bonus[6]}% `;
            if (bonus[3] > 0) bonusText += `All DMG +${bonus[3]}% `;
            if (bonus[8] > 0) bonusText += `Combo DMG +${bonus[8]}% `;
            if (bonus[7] > 0) bonusText += `Smite DMG +${bonus[7]}%`;
            bonusDisplay.textContent = bonusText.trim() || 'No bonus';
        }

        function getSelectedInscriptions() {
            const selected = { special: [], rare: [], common: [] };
            document.querySelectorAll('select[data-category]').forEach(select => {
                if (select.value) {
                    selected[select.dataset.category].push(select.value);
                }
            });
            return selected;
        }

        function calculateScore() {
            const pairing = document.getElementById('pairing').value;
            const formation = document.getElementById('formation').value;
            const attack = parseFloat(document.getElementById('attack').value) || 0;
            const defense = parseFloat(document.getElementById('defense').value) || 0;
            const health = parseFloat(document.getElementById('health').value) || 0;
            const allDamage = parseFloat(document.getElementById('allDamage').value) || 0;
            const selected = getSelectedInscriptions();
            const scales = pairingScales[pairing] || [1,1,1,1,1,1,1,1,1];
            
            let totals = [attack, defense, health, allDamage, 0, 0, 0, 0, 0]; // atk, def, hp, allDmg, na, ca, skill, smite, combo
            
            const formBonus = formationBonuses[formation] || [0,0,0,0,0,0,0,0,0];
            totals = totals.map((t, i) => t + formBonus[i]);

            [...selected.special, ...selected.rare, ...selected.common].forEach(name => {
                const bonus = specialInscriptions[name] || rareInscriptions[name] || commonInscriptions[name] || [0,0,0,0,0,0,0,0,0];
                totals = totals.map((t, i) => t + bonus[i]);
            });

            const scores = totals.map((t, i) => t * scales[i]);
            const finalScore = scores.reduce((sum, current) => sum + current, 0);

            document.getElementById('totalScore').textContent = finalScore.toFixed(2);
            
            const breakdown = document.getElementById('scoreBreakdown');
            breakdown.innerHTML = `
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Atk: <span class="font-bold float-right">${scores[0].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Def: <span class="font-bold float-right">${scores[1].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">HP: <span class="font-bold float-right">${scores[2].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">AllDmg: <span class="font-bold float-right">${scores[3].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Normal Attack: <span class="font-bold float-right">${scores[4].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Counter Attack: <span class="font-bold float-right">${scores[5].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Skill: <span class="font-bold float-right">${scores[6].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Smite: <span class="font-bold float-right">${scores[7].toFixed(2)}</span></div>
                <div class="breakdown-item bg-gray-800/50 p-2 rounded">Combo: <span class="font-bold float-right">${scores[8].toFixed(2)}</span></div>
            `;
        }

        function saveToHistory() {
            const selectedInscriptions = getSelectedInscriptions();
            const entry = {
                id: Date.now(),
                description: document.getElementById('description').value || 'Unnamed Setup',
                score: document.getElementById('totalScore').textContent,
                pairing: document.getElementById('pairing').value,
                formation: document.getElementById('formation').value,
                attributes: { attack: document.getElementById('attack').value, defense: document.getElementById('defense').value, health: document.getElementById('health').value, allDamage: document.getElementById('allDamage').value },
                inscriptions: selectedInscriptions
            };
            calculationHistory.unshift(entry);
            calculationHistory = calculationHistory.slice(0, 20); // Keep max 20 entries
            localStorage.setItem('armamentsHistory_v2', JSON.stringify(calculationHistory));
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const container = document.getElementById('historyContainer');
            container.innerHTML = '';
            if (calculationHistory.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">No calculations saved yet.</p>';
                return;
            }
            calculationHistory.forEach(entry => {
                const div = document.createElement('div');
                div.className = 'p-4 bg-gray-800/50 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-700/50';
                div.innerHTML = `
                    <div>
                        <p class="font-semibold text-white">${entry.description}</p>
                        <p class="text-xs text-gray-400">${entry.pairing} | ${entry.formation}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xl font-bold brand-purple">${entry.score}</p>
                        <p class="text-xs text-gray-500">${new Date(entry.id).toLocaleDateString()}</p>
                    </div>
                `;
                div.onclick = () => loadFromHistory(entry);
                container.appendChild(div);
            });
        }

        function loadFromHistory(entry) {
            document.getElementById('pairing').value = entry.pairing;
            document.getElementById('formation').value = entry.formation;
            document.getElementById('attack').value = entry.attributes.attack;
            document.getElementById('defense').value = entry.attributes.defense;
            document.getElementById('health').value = entry.attributes.health;
            document.getElementById('allDamage').value = entry.attributes.allDamage;
            document.getElementById('description').value = entry.description;

            // Clear all current selections
            document.querySelectorAll('select[data-category]').forEach(s => s.value = '');
            
            if (entry.inscriptions) {
                Object.keys(entry.inscriptions).forEach(category => {
                    const inscriptions = entry.inscriptions[category] || [];
                    const selects = document.querySelectorAll(`select[data-category="${category}"]`);
                    inscriptions.forEach((name, i) => {
                        if(selects[i]) {
                            selects[i].value = name;
                        }
                    });
                });
            }

            updateFormationBonus();
            calculateScore();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function copyDiscordEmbed() {
            const selected = getSelectedInscriptions();
            const formatSelected = (arr) => arr.map(name => name.split('/')[0]).join(', ') || 'None';

            const embed = `\`\`\`
üõ°Ô∏è ${document.getElementById('description').value || 'Armament Setup'}
üìä Score: ${document.getElementById('totalScore').textContent}
üë• Pairing: ${document.getElementById('pairing').value}
‚öîÔ∏è Formation: ${document.getElementById('formation').value}
üìà Attrs: A:${document.getElementById('attack').value} D:${document.getElementById('defense').value} H:${document.getElementById('health').value} AD:${document.getElementById('allDamage').value}
üü† Spec: ${formatSelected(selected.special)}
üîµ Rare: ${formatSelected(selected.rare)}
üü¢ Comm: ${formatSelected(selected.common)}
\`\`\``;
            navigator.clipboard.writeText(embed).then(() => alert('Discord embed copied to clipboard!'));
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all fields?')) {
                document.querySelectorAll('select[data-category]').forEach(s => s.value = '');
                document.getElementById('attack').value = 0;
                document.getElementById('defense').value = 0;
                document.getElementById('health').value = 0;
                document.getElementById('allDamage').value = 0;
                document.getElementById('description').value = '';
                calculateScore();
            }
        }
        
        // --- SITE UI SCRIPT (from InfoCat theme) ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        document.querySelectorAll('#header a').forEach(link => {
            link.addEventListener('click', (e) => {
                if(e.currentTarget.getAttribute('href') === '#') e.preventDefault();
                if (!mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
            });
        });
        const header = document.getElementById('header');
        window.addEventListener('scroll', () => {
            header.classList.toggle('shadow-lg', window.scrollY > 10);
            header.classList.toggle('shadow-purple-900/10', window.scrollY > 10);
        });

        // --- INITIALIZE APP ON DOM LOAD ---
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
